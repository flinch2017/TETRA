<button id="loadMoreBtn" type="button" style="
  position: fixed;
  top: 80px; /* adjust this if you have a site header */
  left: 50%;
  transform: translateX(-50%);
  background: #222;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 25px;
  font-weight: bold;
  font-size: 1rem;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  display: none;
  z-index: 9999;
  cursor: pointer;
">
  Refresh page
</button>


<main class="newsfeed">
  
  <% if (posts.length === 0) { %>
     <div class="no-posts-wrapper">
    <div class="no-posts-icon">ðŸ“­</div>
    <div class="no-posts-text">No posts yet. Stay tuned!</div>
  </div>
  <% } else { %>
    <% posts.forEach(post => { %>
      <div class="post" data-href="/post?postId=<%= post.post_id %>" style="cursor: pointer;" data-post-id="<%= post.post_id %>">

        
        <div class="post-header">
          <div class="post-user-info">
            <a href="/profile?acode=<%= post.acode %>">
              <div class="post-profile-pic" style="background-image: url('<%= post.posterPfpUrl %>');"></div>
            </a>
            <a href="/profile?acode=<%= post.acode %>" class="post-username">
              <%= post.displayName %>
            </a>
          </div>
          <div class="post-dropdown">
            <i class="fas fa-ellipsis-v post-dropdown-toggle"></i>
            <div class="post-dropdown-menu">
              <a href="#">Save</a>
              <a href="#">Report</a>
            </div>
          </div>
        </div>

        <p><%= post.caption %></p>

        <% if (post.images.length > 0) { 
     const filenames = post.images.map(url => url.split('/').pop());
     const visibleImages = filenames.slice(0, 4);
     const hiddenCount = filenames.length - 4;
%>
  <div class="post-collage collage-<%= Math.min(4, filenames.length) %>">
    <% visibleImages.forEach((filename, index) => { %>
      <div class="collage-image-wrapper">
        <img src="/media/image/<%= filename %>" alt="Post image" class="collage-image" data-media-index="<%= index %>" />
        <% if (index === 3 && hiddenCount > 0) { %>
          <div class="more-overlay">+<%= hiddenCount %></div>
        <% } %>
      </div>
    <% }) %>
  </div>
<% } %>



        <% post.tracks.forEach(trackUrl => {
             const filename = trackUrl.split('/').pop(); %>
          <audio controls src="/media/audio/<%= filename %>"></audio>
        <% }) %>

        <% post.videos.forEach(videoUrl => {
             const filename = videoUrl.split('/').pop(); %>
          <video controls src="/media/video/<%= filename %>" width="100%"></video>
        <% }) %>

        <div class="timestamp">Posted <%= post.displayTime %></div>


        <div class="post-actions">
  <button class="post-like-btn" data-post-id="<%= post.post_id %>" title="Like">
    <i class="fa-heart <%= post.isLiked ? 'fa-solid' : 'fa-regular' %>"></i>
    <span><%= post.likeCount %></span>
  </button>

  <button class="post-comment-btn" title="Comment">
  <i class="fa-regular fa-comment"></i>
  <span><%= post.commentCount %></span>
</button>


  <button class="post-share-btn" title="Share">
    <i class="fa-regular fa-share-from-square"></i>
  </button>
</div>



      </div>

    <% }) %>
  <% } %>
</main>








